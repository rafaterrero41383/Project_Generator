<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<TargetEndpoint name="backend">
  <Description>Rec Reference Data</Description>
  <PreFlow name="PreFlow">
    <Request/>
    <Response>
      <Step>
        <Name>JS-RemoveResponseBasePath</Name>
      </Step>
    </Response>
  </PreFlow>
  <Flows>
    <Flow name="BusRetrieveOCRDocument">
      <Description>Servicio de negocio que se encarga de retornar datos sobre la lectura del usuario de la declaración de identificación y dirección envuelta en el objeto ocrData.</Description>
      <Condition>proxy.pathsuffix MatchesPath "/v1/ocrDocument/retrieve" AND request.verb = "GET"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RecRetrieveOCRDocumentT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="V1OnBoardingPartySuitabilityEvaluate_POST">
      <Description>Servicio de negocio que se encarga de consultar, validar, curp y al cliente en las listas negras respectivas</Description>
      <Condition>proxy.pathsuffix MatchesPath "/v1/onBoardingPartySuitability/evaluate" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RecEvaluateOnBoardingPartySuitabilityT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="V1CustomerRetrieve_POST">
      <Condition>proxy.pathsuffix MatchesPath "/v1/customer/retrieve" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RemoveHeaders</Name>
        </Step>
        <Step>
          <Name>AM-RetrieveCustomerT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="V1RetrievePaymentBalancesRetrieve_POST">
      <Condition>proxy.pathsuffix MatchesPath "/v1/retrievePaymentBalances/retrieve" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>JS-RetrievePaymentBalancesFacilityT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="V1CustomerCardRetrieve_POST">
      <Condition>proxy.pathsuffix MatchesPath "/v1/customerCard/retrieve" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>JS-RetrieveCustomerCardT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="BusInitiateIncomeProfileV1">
      <Description>Servicio de recepción para el registro de la fuente de ingresos y tipo de residencia del cliente en el proceso de Alta de un Cliente Nuevo (Alta Única)</Description>
      <Condition>proxy.pathsuffix MatchesPath "/v1/incomeProfile/initiate" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RemoveHeaders</Name>
        </Step>
        <Step>
          <Name>AM-InitiateIncomeProfileT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="BusCustomerRelationshipInvolvementInitiate">
      <Condition>proxy.pathsuffix MatchesPath "/v1/customerRelationshipInvolvement/initiate" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RemoveHeaders</Name>
        </Step>
        <Step>
          <Name>AM-RecInitiateCustomerRelationshipInvolvementT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="V1OnboardingPartyExecute_PUT">
      <Condition>proxy.pathsuffix MatchesPath "/v1/onBoardingParty/execute" AND request.verb = "PUT"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>JS-ExecuteOnboardingPartyT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
    <Flow name="Rec_RetrieveCustomerIdentity_POST">
      <Description>API de recepción encargado de validar el CURP mediante la integración con el servicio proporcionado por RENAPO (Incode) dom_retrieveRenapo. Con la finalidad de asegurar la veracidad de la información proporcionada por el usuario (datos personales) y realizando un guardado de la información en Yugabite (Dom_CaptureRenapo). En el proceso de onboarding.</Description>
      <Condition>proxy.pathsuffix MatchesPath "/v1/customerIdentity/retrieve" AND request.verb = "POST"</Condition>
      <Request/>
      <Response>
        <Step>
          <Name>AM-RecRetriveCustomerIdentityT2</Name>
        </Step>
        <Step>
          <Name>OAS-Response</Name>
        </Step>
        <Step>
          <Name>FC-Encrypt</Name>
        </Step>
      </Response>
    </Flow>
  </Flows>
  <PostFlow name="PostFlow">
    <Response>
      <Step>
        <Name>AM-RemoveHeaders</Name>
      </Step>
      <Step>
        <Name>FC-DataDog-Unity</Name>
      </Step>
    </Response>
  </PostFlow>
  <FaultRules/>
  <DefaultFaultRule name="default-fault">
    <Step>
      <Name>FC-ErrorHandler-Unity</Name>
    </Step>
  </DefaultFaultRule>
  <HTTPTargetConnection>
    <LoadBalancer>
      <Server name="ilb-southbound"/>
    </LoadBalancer>
    <Path>/envoy/bus-reference-data/referenceData</Path>
  </HTTPTargetConnection>
</TargetEndpoint>
